\documentclass[12pt, a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{array}
\usepackage{graphicx}
\usepackage{parskip}
\usepackage[pdfencoding=auto]{hyperref}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{tikz}
\usepackage{float}
\usepackage{listings}
\usepackage{color}
\usepackage{caption}
\usepackage{authblk}
\usepackage[acronym]{glossaries}
\usepackage[nottoc]{tocbibind}
\usepackage[cache=false]{minted}
\usemintedstyle{default}
\newminted{haskell}{frame=lines,framerule=2pt}
\newminted{R}{frame=lines,framerule=2pt}
\newminted{cpp}{frame=lines,framerule=2pt}
\graphicspath{{./images/}}

\tikzstyle{bag} = [align=center]

\title{%
      Homework 3\\
      Significance of Metrics\\
}
\author{Juan Pablo Royo Sales}
\affil{Universitat Polit√®cnica de Catalunya}
\date\today

\pagestyle{fancy}
\fancyhf{}
\fancyhead[C]{}
\fancyhead[R]{UPC MIRI}
\fancyhead[L]{CSN - Homework 3}
\fancyfoot[L,C]{}
\fancyfoot[R]{Page \thepage{} of \pageref{LastPage}}
\setlength{\headheight}{15pt}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

\newacronym{lang}{Language Set}{Provided Language Set}
\newacronym{switching}{Switching Model}{Null Model based on Switching}
\newacronym{binomial}{Binomial Model}{Null Model based on Binomial Erdos Renyi}
\newacronym{cc}{Closeness Centratlity}{Closeness Centratlity Measure}
\newacronym{nh}{Null Hypothesis}{Null Hypothesis}
\newacronym{mc}{Montecarlo}{Montecarlo Approximation Algorithm}

\begin{document}

\maketitle

\tableofcontents

\section{Introduction}
In this work I have been analyzing the significance of \acrfull{cc} metric over a \acrfull{lang} provided for such case.
Basically the idea of the work is the following: Giving this set of Languages with some set of connected terms, determine 
the \acrshort{cc} accurately measured. Hypothesis

After that I am going to measure the \textbf{Significance} of that metric against different \acrshort{nh}, in particular against \acrfull{switching} and \acrfull{binomial}.

Using a \acrfull{mc} I am going to approximate the \textit{p-value} of both \textbf{Null} Hypothesis against the real model for each language.

The present work is divided in the following sections:

\begin{itemize}
    \item \textbf{Results} section: Where I show the results obtained for each language according to the previous statements.
    \item \textbf{Discussion} section: In this section I will provide some discussion about the results and my personal impression.
    \item \textbf{Methods} section: Where i am going to describe each of the method and technique use to do the work.
    \item \textbf{Conclusions} section: Finally I am going to give my opinion about the results obtained and what I have learnt.
\end{itemize}

\section{Results}
Lets divide the results for each language, but first lets see the Summary of the data that I am analyzing.

\subsection{Languages Main Characteristics}

\begin{table}[H]
    \centering
    \begin{tabular}{l l l l l}
    Language & N & E & $<k>$ & $\delta$ \\
     \hline
    Arabic & 21532 & 68743 & 6.3851941 & 0.0002966 \\
    Basque & 12207 & 25541 & 4.1846482 & 0.0003428 \\
    Catalan & 36865 & 197075 & 10.6917130 & 0.0002900 \\
    Chinese & 40298 & 180925 & 8.9793538 & 0.0002228 \\
    Czech & 69303 & 257254 & 7.4240365 & 0.0001071 \\
    English & 29634 & 193078 & 13.0308430 & 0.0004397 \\
    Greek & 13283 & 43961 & 6.6191372 & 0.0004984 \\
    Hungarian & 36126 & 106681 & 5.9060510 & 0.0001635 \\
    Italian & 14726 & 55954 & 7.5993481 & 0.0005161 \\
    Turkish & 20409 & 45625 & 4.4710667 & 0.0002191 \\
    \end{tabular}
   \caption{Language List - Main Characteristics}
   \label{table:1}
\end{table}

\subsection{Closeness Centrality Measures}

\begin{table}[H]
  \centering
  \begin{tabular}{l c c c}
  Language & Metric & p-value (switching) & p-value (binomial)\\
   \hline
   Arabic & 0.3264629  & 1.00 & 0.00 \\
   Basque & 0.2697357  & 0.00 & 0.00 \\
   Catalan & 0.3410137 & 1.00 & 0.00 \\
   Chinese & 0.3264578 & 0.95& 0.00 \\
   Czech & 0.3059504 & 1.00 & 0.00 \\
   English & 0.3435143  & 1.00 & 0.00 \\
   Greek & 0.3147265  & 1.00 & 0.00 \\
   Hungarian & 0.2883495 & 1.00 & 0.00 \\
   Italian & 0.3278253 & 1.00 & 0.00 \\
   Turkish & 0.3603390  & 0.00 & 0.00 \\
     \end{tabular}
 \caption{Language List - Closeness Centrality}
 \label{table:2}
\end{table}


\section{Discussion}
\subsection{Switching}
Accordingly to the results obtained as it can be appreciate in~\ref{table:2} the majority of the \textbf{p-value} for the 
\acrshort{switching} are close to $1.00$ except for the \textbf{Basque} and \textbf{Turkish} language. This means that I can \textbf{accept the \acrfull{nh}}  
for the \acrshort{switching}. As we can see for almost all iterations \acrshort{cc} value is greater than the real model and most of them are above percentile $0.95$ or more.
For detailed iterations and values of each \acrshort{cc} of each iteration and for each language, please see results on \mintinline{bash}{docs/results_montecarlo.txt}.

If we analyze for example some of those detailed outputs of the results that can be found in \mintinline{bash}{docs/results_montecarlo.txt},
in the cases of languages whose I need to \textbf{accept the \acrshort{nh}}, I have detected that the difference between the real value and for every
iteration is very small. 

\begin{listing}[H]
    \inputminted[firstline=58, lastline=78, breaklines]{bash}{./results_montecarlo.txt}
    \caption{Extracted from folder docs results\_montecarlo.txt}
    \label{apx:results:1}
\end{listing}  

As it can be seen here~\ref{apx:results:1} the real \acrshort{cc} for \textbf{Catalan} language is \textbf{$0.3410102$}
and all values generated by the random \acrshort{switching} have been between $0.3498$ and $0.3556$ which indicates that
the \acrshort{cc} is higher than the real but very close to it.

On the other hand the same can be said about the \textbf{rejection cases} whose \textit{p-value} gives $0.00$ in this \acrshort{nh}.
In those cases, \textbf{Basque and Turkish language}, it can be appreciated that although there is a \textbf{rejection} because \acrshort{cc} 
is less than the real value of the metric, the values for each iteration are very close to the real \acrshort{cc}, so the distance between \acrshort{cc} of 
\acrshort{nh} and real model is very small.

\begin{listing}[H]
    \inputminted[firstline=12, lastline=32, breaklines]{bash}{./results_montecarlo.txt}
    \caption{Extracted from folder docs results\_montecarlo.txt}
    \label{apx:results:2}
\end{listing}  

For example, lets analyze \textbf{Basque} language. \acrshort{cc} value for the real model is $0.2697194$, and the values obtained
in \acrshort{nh} have been between  $0.2575014 \leq x_{hnull} \geq 0.2633076$, which indicates that the difference with the lower bound and the real
value is only $0.012$. This led me to think that perhaps tunning better the random generation of the graph or the number of permutations in the \acrshort{switching}
can narrow the values a little more in order to accept the \acrshort{nh}. I haven't done that because that should be forcing the \acrshort{nh} to match with the expected
results and that wouldn't be a serious experiment.

\subsection{Binomial}
Regarding the \acrshort{binomial} none of the random generated graphs has been close to the real \acrshort{cc} of the given models,
and it can be seen by the results output file \mintinline{bash}{docs/results_montecarlo.txt}, that all of the them behaves in a stable number according to the 
number of \textbf{Edges and Vertices} that were provided for generating the Random Graph.

This could be explain by the fact that \acrshort{binomial} are fully random graph and \acrshort{cc} is an intrinsic property of \textbf{non random graph}, because it indicates how concentrated 
are the elements around some of them. In the previous \acrshort{switching} this behavior was different and it gives more accurate \acrshort{cc} values, because it is a permutation
over the same graph, and in that permutation I tried to preserve the structure of the original graph, although the selection of the \textbf{vertices} that are selected for switching itself is random.

Therefore, I need to \textbf{reject} the \acrshort{nh} in the case of \acrshort{binomial}.

\section{Methods}
In this section i am going to describe the method used for arriving to this conclusions, starting from analyzing the source code, following up to the parameters selected
for running the analysis.


\subsection{Experiment Parameters}
I have set different type of parameters for the case of \acrshort{switching} and \acrshort{binomial}.

For the case of \acrshort{switching}
\begin{itemize}
    \item $T = 20$ 
    \item $Q = 15$
\end{itemize}

For the case of \acrshort{binomial} since i detected early that because of the fully randomization i will never going to achieve a close result, i decided
to setup:
\begin{itemize}
    \item $T = 10$ 
\end{itemize}


\subsection{Source Code Implementation}
When we talk about the methodology that it is used for conducting this kind of experiments it is a very important to remark what have been the decisions regarding the implementation in the source
code.
As it can be seen in the folder of this distribution, the language use was \textbf{C++}.

\subsubsection{Graph Representation}

Basically the Graph of the language is represented by an Adjacency matrix of the \textbf{Vertex} and \textbf{Edges} that are connected to those edges.

\begin{listing}[H]
    \inputminted[firstline=44, lastline=51, breaklines]{cpp}{../src/domain/graph.cc}
    \caption{Extracted from source code graph.cc}
    \label{source:code:1}
\end{listing}  

In this case it is worth to mention that \mintinline{cpp}{map<string, set<string>> _edges} and \mintinline{cpp}{vector<EDGE> inputEdges} are additional 
structures to deal with the reorder base on degree distribution or random sort. 
All the computations are done over the array of edges \mintinline{cpp}{vector<int> *adj} which is the adjacency list.

\subsubsection{Order of Edges}
After several and different experimentation I have finally decide to order the edges by \textbf{Degree sequence in descendent order}.

This can be seen here, where after parsing the whole input file i am ordering the edges and finally creating the adjacency list.

\begin{listing}[H]
    \inputminted[firstline=151, lastline=167, breaklines]{cpp}{../src/domain/graph.cc}
    \caption{Extracted from source code graph.cc}
    \label{source:code:2}
\end{listing}  

\subsubsection{Closeness Centrality}
The calculation of \acrshort{cc} is as it was proposed in the work, a regular \textbf{BFS} Bread First Search algorithm 
that can be seen here:

\begin{listing}[H]
    \inputminted[firstline=233, lastline=270, breaklines]{cpp}{../src/domain/graph.cc}
    \caption{Extracted from source code graph.cc}
    \label{source:code:3}
\end{listing} 

I have a couple of lines below that methods a calculation over the first $M$ items as it was 
proposed in order to optimize the calculations but this has never worked for me, so i never implemented.

\subsubsection{Montecarlo}
In the case of \acrshort{mc} I have implemented the generation of the \acrshort{binomial} which can be found here:

\begin{listing}[H]
    \inputminted[firstline=77, lastline=107, breaklines]{cpp}{../src/graph/aprox.cc}
    \caption{Extracted from source code aprox.cc}
    \label{source:code:4}
\end{listing} 

And in the case of \acrshort{switching} it is a slightly more complicated because i needed to take care of no breaking the 
structure of the graph when i toss the coin to switch 2 terminals of 2 different edges.

Basically the main implementation of the \acrshort{switching} can be seen here:

\begin{listing}[H]
    \inputminted[firstline=64, lastline=74, breaklines]{cpp}{../src/graph/aprox.cc}
    \caption{Extracted from source code aprox.cc}
    \label{source:code:5}
\end{listing} 

But the \mintinline{cpp}{TrySwitch} method which is doing the whole work can be found here:

\begin{listing}[H]
    \inputminted[firstline=280, lastline=317, breaklines]{cpp}{../src/domain/graph.cc}
    \caption{Extracted from source code graph.cc}
    \label{source:code:6}
\end{listing} 

As it can be appreciated this is a more complex code because i am preventing to do a switching which 
can generate that the whole structure of the graph can be broken.

\section{Conclusions}
One of the first conclusions i can arrive after doing these experiments is that \acrshort{switching} is a more accurate
tool in order to measure the significance of \acrshort{cc}. On the other hand \acrshort{binomial} is something that in the case
of \acrshort{cc} doesn't apply because of the fully randomization of the generated model, which cannot represent properly a strong
relationship regarding a set of important nodes. 

Moreover, it can be appreciated that perhaps regardless the value of $T$ \acrshort{binomial} is not suitable as measuring tool for this
metric.

As a future work, it would be important to explore other mechanisms to tunning better the \acrshort{nh} model generators in order
to have the same level of randomization but preserving better \acrshort{cc} characteristics of the original model.

In conclusion although it is quite hard to iterate over a large number of $T$ in order to measure properly the \acrshort{cc} based on the \acrshort{nh},
it has been seen that \acrshort{switching} gives us very accurate approximation.

\printglossary[type=\acronymtype]

\appendix\label{apx:org}
\section{Source Code and Assets}
The source code and different assets that are contained in these folders are classified in the following way.

\begin{itemize}
    \item \textbf{bin} This folder contains the compiled binary files for the code that implements the requirements suggested by the lab work.
    \item \textbf{data} This folder contains the input \acrshort{lang} provided.
    \item \textbf{docs} This folder contains this report in Latex and PDF compiled format.
    \item \textbf{out} This folder contains the standar output results after executing each program over the \acrshort{lang}
    \item \textbf{src} This folder contains the \mintinline{bash}{cpp} files with the source code implementation.
    \item \textbf{\mintinline{bash}{./Makefile}} Makefile to compile programs
    \item \textbf{\mintinline{bash}{./README.md}} Markdown file with the instructions to run the program.
    \item \textbf{\mintinline{bash}{./run_closeness.sh}} Script file for running the algorithm over the \acrshort{lang} in order to calculate \textit{Closeness Centrality} and 
    main features of each language.
    \item \textbf{\mintinline{bash}{./run_montecarlo.sh}} Script file for running the aproximation algorithms for each language with null models.
\end{itemize}

\end{document}